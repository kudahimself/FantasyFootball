{% extends "base.html" %}
{% load static %}

{% block title %}Player Ratings{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/player_ratings.css' %}">

<h1 class="page-title">Player Ratings</h1>

{% if error %}
    <div class="alert alert-danger">
        <strong>Error:</strong> {{ error }}
    </div>
{% endif %}

<div class="stats-summary">
    <strong>Total Players:</strong> {{ total_players }} | 
    <span id="filtered-count">{{ total_players }}</span> showing
</div>

<!-- Filters -->
<div class="filters">
    <h5>Filters & Search</h5>
    <div class="filter-row">
        <div class="filter-group">
            <label for="search-player">Player Name:</label>
            <input type="text" id="search-player" class="form-control" placeholder="Search player...">
        </div>
        
        <div class="filter-group">
            <label for="filter-position">Position:</label>
            <select id="filter-position" class="form-control">
                <option value="">All Positions</option>
                <option value="Keeper">Goalkeepers</option>
                <option value="Defender">Defenders</option>
                <option value="Midfielder">Midfielders</option>
                <option value="Attacker">Attackers</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label for="filter-cost-min">Min Cost:</label>
            <input type="number" id="filter-cost-min" class="form-control" placeholder="4.0" step="0.1" min="4.0" max="15.0">
        </div>
        
        <div class="filter-group">
            <label for="filter-cost-max">Max Cost:</label>
            <input type="number" id="filter-cost-max" class="form-control" placeholder="15.0" step="0.1" min="4.0" max="15.0">
        </div>
        
        <div class="filter-group">
            <label for="filter-elo-min">Min Elo:</label>
            <input type="number" id="filter-elo-min" class="form-control" placeholder="1000" step="50">
        </div>
        
        <div class="filter-group">
            <label for="filter-points-min">Min Projected Points:</label>
            <input type="number" id="filter-points-min" class="form-control" placeholder="0" step="1" min="0">
        </div>
        
        <div class="filter-group" style="justify-content: flex-end;">
            <label>&nbsp;</label>
            <button class="btn-clear" onclick="clearFilters()">Clear All</button>
        </div>
    </div>
</div>

<!-- Players Table -->
<div class="table-container">
    <table class="table table-striped table-hover" id="players-table">
        <thead class="thead-dark" style="background: #0E223B;color: #fcfafa;">
            <tr>
                <th class="sortable" data-column="name" data-type="string">Player Name</th>
                <th class="sortable" data-column="position" data-type="string">Position</th>
                <th class="sortable" data-column="elo" data-type="number">Elo Rating</th>
                <th class="sortable" data-column="cost" data-type="number">Cost (£m)</th>
                <th class="sortable" data-column="projectedPoints" data-type="number">Projected Points</th>
                <th class="sortable" data-column="fixture_1" data-type="string">Next 3 Fixtures</th>
            </tr>
        </thead>
        <tbody id="players-tbody">
            {% for player in players %}
            <tr class="player-row" 
                data-name="{{ player.name|lower }}" 
                data-position="{{ player.position }}"
                data-elo="{{ player.elo }}"
                data-cost="{{ player.cost }}"
                data-projected-points="{{ player.projected_points }}"
                data-fixture-1="{{ player.fixture_1 }}"
                data-fixture-2="{{ player.fixture_2 }}"
                data-fixture-3="{{ player.fixture_3 }}">
                
                <td>
                    <strong>
                        <a href="{% url 'player_info' player.name %}" class="player-link">
                            {{ player.name }}
                            <i class="fas fa-external-link-alt ml-1" style="font-size: 0.8em;"></i>
                        </a>
                    </strong>
                </td>
                
                <td>
                    <span class="badge 
                        {% if player.position == 'Keeper' or player.position == 'GKP' %}bg-secondary text-dark{% endif %}
                        {% if player.position == 'Defender' or player.position == 'DEF' %}bg-warning{% endif %}
                        {% if player.position == 'Midfielder' or player.position == 'MID' %}bg-success{% endif %}
                        {% if player.position == 'Attacker' or player.position == 'FWD' %}bg-primary{% endif %}
                        ms-2">
                        {% if player.position == 'Keeper' or player.position == 'GKP' %}GKP
                        {% elif player.position == 'Defender' or player.position == 'DEF' %}DEF
                        {% elif player.position == 'Midfielder' or player.position == 'MID' %}MID
                        {% elif player.position == 'Attacker' or player.position == 'FWD' %}FWD
                        {% endif %}
                    </span>
                </td>
                
                <td>
                    <span class="{% if player.elo >= 1900 %}elo-high{% elif player.elo >= 1400 %}elo-medium{% else %}elo-low{% endif %}">
                        {{ player.elo }}
                    </span>
                </td>
                
                <td>
                    <span class="{% if player.cost >= 8 %}cost-high{% elif player.cost >= 7 %}cost-medium{% else %}cost-low{% endif %}">
                        £{{ player.cost }}m
                    </span>
                </td>
                
                <td>
                    <span class="{% if player.projected_points >= 11 %}points-high{% elif player.projected_points >= 7 %}points-medium{% else %}points-low{% endif %}">
                        {{ player.projected_points }}
                    </span>
                </td>
                
                <td class="fixtures-cell">
                    <div class="fixtures-container">
                        <div class="fixture difficulty-{{ player.fixture_1_difficulty }}">{{ player.fixture_1 }}</div>
                        <div class="fixture difficulty-{{ player.fixture_2_difficulty }}">{{ player.fixture_2 }}</div>
                        <div class="fixture difficulty-{{ player.fixture_3_difficulty }}">{{ player.fixture_3 }}</div>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No players found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="{% static 'js/player_ratings.js' %}"></script>

{% endblock %}
